<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衣服の購買における金銭感覚の調査</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        @media screen and (orientation: portrait) {
            #orientation-message {
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.9);
                color: white;
                font-size: 1.5rem;
                font-weight: bold;
                justify-content: center;
                align-items: center;
                text-align: center;
                z-index: 1000;
                padding: 1rem;
            }
            #survey-container {
                display: none;
            }
        }
        @media screen and (orientation: landscape) {
            #orientation-message {
                display: none;
            }
            #survey-container {
                display: block;
                max-width: 800px;
                width: 100%;
            }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .survey-page {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .survey-page.active {
            display: block;
            opacity: 1;
        }
        .custom-radio-group {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }
        .custom-radio-item {
            flex: 1;
            min-width: 0;
            position: relative;
            padding: 0 8px;
        }
        .custom-radio-item label {
            text-align: center;
            width: 100%;
            display: block;
            white-space: normal;
            word-break: keep-all;
        }
        .custom-radio-item:not(:last-child)::after {
            content: "";
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(30%, -50%);
            width: 90px;
            height: 2px;
            background: #a0aec0;
            z-index: 0;
        }
    </style>
</head>
<body>
    <div id="orientation-message" class="hidden">
        <p>スマホは<span class="text-yellow-400">横画面</span>、パソコンは<span class="text-yellow-400">全画面</span>で回答してください。</p>
    </div>
    <div id="survey-container" class="bg-white p-8 rounded-lg shadow-xl border border-gray-200 max-w-2xl w-full">
        <h1 id="main-survey-title" class="text-4xl font-extrabold text-gray-900 mb-8 text-center">衣服の購買における金銭感覚の調査</h1>
        <form id="survey-form" class="space-y-6">
            <!-- ページ0: 表紙ページ -->
            <div class="survey-page active" data-page="0">
                <p class="text-gray-700 text-lg mb-10 text-center">
                    この度は、調査にご協力いただき、ありがとうございます。<br>
                    私は現在、みなさんの「衣服の購買に関する金銭感覚」について調査を行っています。<br>
                    貴重なお時間を頂戴し、誠に恐縮ですが、なにとぞ、研究の趣旨をご理解の上、調査への回答にご協力いただけますよう、お願い申し上げます。<br>
                    <br>
                    調査対象者は、専門学生・短期大学生・大学生・大学院生・18～22歳の方です。<br>
                    該当しない方は、ブラウザを閉じてください。<br>
                    <br>
                    【研究代表者】<br>
                    静岡県立大学　経営情報学部　4年　野村優介<br>
                </p>
                <div class="flex justify-center mt-12">
                    <button type="button" onclick="nextPage()" class="py-3 px-10 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ1: 同意 -->
            <div class="survey-page" data-page="1">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">研究参加への同意</h2>
                <p class="text-gray-700 mb-8">
                    この調査は卒業研究の一環で行われます。<br>
                    この調査では、あなたの幼少期の経験が、衣服の購買における現在の金銭的な価値観に影響を与えるのかどうかを明らかにすることを目的としています。<br>
                    この調査には、正しい回答や間違った回答、社会的に望ましい回答などはありません。<br>
                    あなたの経験や考えに沿って、まじめに回答していただけると幸いです。<br>
                    また収集するデータは、個人が特定されることはなく、統計的に分析されます。<br>
                    調査へご参加いただける方は「同意する」、参加しない方は「同意しない」を選択し、「次へ」を押してください。<br>
                    何かご不明な点等ございましたら、下記へご連絡ください。<br>
                    <br>
                    【お問い合わせ先】<br>
                    静岡県立大学　経営情報学部　4年　野村優介<br>
                    e-mail: b22091@u-shizuoka-ken.ac.jp
                </p>
                <div class="mb-6">
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center">
                            <input id="agree-radio" name="同意" type="radio" value="同意する" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="agree-radio" class="ml-3 block text-sm text-gray-700">同意する</label>
                        </div>
                        <div class="flex items-center">
                            <input id="disagree-radio" name="同意" type="radio" value="同意しない" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="disagree-radio" class="ml-3 block text-sm text-gray-700">同意しない</label>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPageConditional()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ2: 基本情報 -->
            <div class="survey-page" data-page="2">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">基本情報</h2>
                <!-- 質問1: 年齢 -->
                <div class="mb-6">
                    <label for="age" class="block text-sm font-medium text-gray-700 mb-1">あなたの年齢を入力してください（半角数字）</label>
                    <input type="number" id="age" name="年齢" class="mt-1 block w-full rounded-md border border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                </div>
                <!-- 質問2: 性別 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">あなたの性別を選択してください</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="gender-male" name="性別" type="radio" value="男性" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="gender-male" class="ml-3 block text-sm text-gray-700">男性</label>
                        </div>
                        <div class="flex items-center">
                            <input id="gender-female" name="性別" type="radio" value="女性" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="gender-female" class="ml-3 block text-sm text-gray-700">女性</label>
                        </div>
                        <div class="flex items-center">
                            <input id="gender-other" name="性別" type="radio" value="その他" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="gender-other" class="ml-3 block text-sm text-gray-700">その他</label>
                        </div>
                    </div>
                </div>
                <!-- 質問3: 所属 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">あなたの現在の所属を教えてください</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="affiliation-spec-college" name="所属" type="radio" value="専門学生" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="affiliation-spec-college" class="ml-3 block text-sm text-gray-700">専門学生</label>
                        </div>
                        <div class="flex items-center">
                            <input id="affiliation-jr-college" name="所属" type="radio" value="短期大学生" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="affiliation-jr-college" class="ml-3 block text-sm text-gray-700">短期大学生</label>
                        </div>
                        <div class="flex items-center">
                            <input id="affiliation-university" name="所属" type="radio" value="大学生" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="affiliation-university" class="ml-3 block text-sm text-gray-700">大学生</label>
                        </div>
                        <div class="flex items-center">
                            <input id="affiliation-grad" name="所属" type="radio" value="大学院生" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="affiliation-grad" class="ml-3 block text-sm text-gray-700">大学院生</label>
                        </div>
                        <div class="flex items-center">
                            <input id="affiliation-other" name="所属" type="radio" value="学生ではない" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="affiliation-other" class="ml-3 block text-sm text-gray-700">学生ではない</label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ3: 衣服の購買頻度などの質問 -->
            <div class="survey-page" data-page="3">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">衣服の購買頻度などの質問</h2>
                <p class="text-gray-700 mb-8">
                    選択肢の中から、最もあてはまるものを選択してください。
                </p>
                <!-- 質問: 購買頻度 -->
                <div class="mb-6">
                    <label for="purchase-frequency" class="block text-sm font-medium text-gray-700 mb-1">あなたは普段どれくらいの頻度で衣服を購入していますか</label>
                    <select id="purchase-frequency" name="購買頻度" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm" required>
                        <option value="">選択してください</option>
                        <option value="1ヶ月に1回より多い">1ヶ月に1回より多い</option>
                        <option value="1ヶ月に1回程度">1ヶ月に1回程度</option>
                        <option value="2ヶ月に1回程度">2ヶ月に1回程度</option>
                        <option value="3ヶ月に1回程度">3ヶ月に1回程度</option>
                        <option value="4か月に1回程度かそれ以下">4か月に1回程度かそれ以下</option>
                    </select>
                </div>
                <!-- 質問: 一度に使う金額 -->
                <div class="mb-6">
                    <label for="single-purchase-amount" class="block text-sm font-medium text-gray-700 mb-1">あなたは一度（一日）の衣服の購入で、どれくらいの金額を使いますか</label>
                    <select id="single-purchase-amount" name="一度に使う金額" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm" required>
                        <option value="">選択してください</option>
                        <option value="3000円以内">3000円以内</option>
                        <option value="3001～4000円">3001～4000円</option>
                        <option value="4001～5000円">4001～5000円</option>
                        <option value="5001～6000円">5001～6000円</option>
                        <option value="6001～7000円">6001～7000円</option>
                        <option value="7001～8000円">7001～8000円</option>
                        <option value="8001～9000円">8001～9000円</option>
                        <option value="9001～10000円">9001～10000円</option>
                        <option value="1万円以上">1万円以上</option>
                    </select>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ4: 所属世帯について -->
            <div class="survey-page" data-page="4">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">所属世帯について</h2>
                <!-- 質問: 所属世帯について (条件分岐のトリガー) -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">現在の所属世帯を教えてください</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="household-live-with-parents" name="所属世帯" type="radio" value="実家暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-live-with-parents" class="mt-1 block text-sm text-gray-700">出生から今日まで実家暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-hs" name="所属世帯" type="radio" value="高校生から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-live-alone-hs" class="mt-1 block text-sm text-gray-700">高校生から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-univ" name="所属世帯" type="radio" value="大学生から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-live-alone-univ" class="mt-1 block text-sm text-gray-700">大学生から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-grad" name="所属世帯" type="radio" value="大学院生から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-live-alone-grad" class="mt-1 block text-sm text-gray-700">大学院生から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-work" name="所属世帯" type="radio" value="就職から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-live-alone-work" class="mt-1 block text-sm text-gray-700">就職してから一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-returned-home" name="所属世帯" type="radio" value="一人暮らしから実家暮らしに戻っている" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-returned-home" class="mt-1 block text-sm text-gray-700">一人暮らしの時期があったが、現在は実家暮らしに戻っている</label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ5: 収入などについての質問 -->
            <div class="survey-page" data-page="5">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">収入などについての質問</h2>
                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">自分の収入から、実家・保護者に対して仕送りしている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="household-contribute-yes" name="家庭にお金を入れている" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-contribute-yes" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-contribute-no" name="家庭にお金を入れている" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="household-contribute-no" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                    </div>
                </div>
                    
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">家賃補助を実家から受け取っている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="rent-subsidy-yes-alone" name="家賃補助" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="rent-subsidy-yes-alone" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="rent-subsidy-no-alone" name="家賃補助" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="rent-subsidy-no-alone" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                    </div>
                </div>
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">奨学金や学費の減額などの支援を、公的な機関から受けている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="scholarship-yes" name="奨学金" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="scholarship-yes" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="scholarship-no" name="奨学金" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="scholarship-no" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                        <div class="flex items-center">
                            <input id="scholarship-was-received" name="奨学金" type="radio" value="以前受けていた" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                            <label for="scholarship-was-received" class="mt-1 block text-sm text-gray-700">受けていた時期があるが、今は受けていない</label>
                        </div>
                    </div>
                </div>
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label for="part-time-income-home" class="block text-sm font-medium text-gray-700 mb-1">アルバイトの収入</label>
                    <select id="part-time-income-home" name="アルバイトの収入" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm" required>
                        <option value="">選択してください</option>
                        <option value="月5万円未満">月5万円未満</option>
                        <option value="月5～6万円">月5～6万円</option>
                        <option value="月6～7万円">月6～7万円</option>
                        <option value="月7～8万円">月7～8万円</option>
                        <option value="月8万円以上">月8万円以上</option>
                        <option value="アルバイトをしていない">アルバイトをしていない</option>
                        <option value="就職している">就職している</option>
                    </select>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ6: 次のセクションについて -->
            <div class="survey-page" data-page="6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">次のセクションについて</h2>
                <p class="text-gray-700 mb-10">
                    <!-- 質問の説明 -->
                    次のセクションでは、<br>
                    あなたの幼少期から現在における「家庭の環境やお金の教育」についてお聞きします。<br>
                    「全くあてはまらない」～「とてもあてはまる」の<br>
                    5つの選択肢から該当するものを選択してください。
                </p>
                <div class="mb-6">
                    <div class="flex items-center">
                        <input id="illustration" name="質問の説明" type="radio" value="確認しました" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                        <label for="illustration" class="ml-3 block text-sm text-gray-700">確認しました</label>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ7: 家庭についての質問 (ランダム表示用コンテナ) -->
            <div class="survey-page" data-page="7">
                <div id="random-question-content" class="text-center">
                </div>
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ8: 衣服の購買シミュレーション説明 -->
            <div class="survey-page" data-page="8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">衣服の購買シミュレーション説明</h2>
                <p class="text-gray-700 mb-8">
                    次のセクションでは衣服の画像と価格、その他の情報が表示されます。<br>
                    あなたは、その衣服を「買う」か「買わない」かを選択します。<br>
                    価格が変化するので、あなたが妥当だと感じれば「買う」、<br>
                    高すぎると感じれば「買わない」選択してください。<br>
                    ※選択後すぐに、新しい情報へ更新されるため、ボタンを連打しないよう注意してください。
                </p>
                <div class="mb-6">
                    <div class="flex items-center">
                        <input id="confirmation" name="シミュレーション説明確認" type="radio" value="確認しました" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                        <label for="confirmation" class="ml-3 block text-sm text-gray-700">確認しました</label>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ9: 衣服の購買シミュレーション -->
            <div class="survey-page" data-page="9">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">購買シミュレーション</h2>
                <div class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg shadow-inner mb-6">
                    <img id="clothing-image" src="https://github.com/researchforme/my_survey_img/blob/main/%E3%82%B8%E3%83%A3%E3%82%B1%E3%83%83%E3%83%88.png?raw=true" alt="Clothing Item" class="rounded-md shadow-md mb-4 w-full max-w-sm">
                    <p class="text-xl font-medium text-gray-700 mb-2">種類: <span id="clothing-item-type" class="font-semibold text-gray-900"></span></p>
                    <p class="text-xl font-medium text-gray-700 mb-2">すでに持っている服との組み合わせ: <span id="clothing-combination" class="font-semibold text-gray-900"></span></p>
                    <p class="text-xl font-medium text-gray-700 mb-4">利用場面: <span id="clothing-situation" class="font-semibold text-gray-900"></span></p>
                    <p class="text-2xl font-bold text-gray-900 mb-6">価格: <span id="current-price"></span>円</p>
                    <div class="flex space-x-4">
                        <button type="button" id="buy-button" onclick="handlePurchaseChoice('buy')" class="py-3 px-8 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                            買う
                        </button>
                        <button type="button" id="dont-buy-button" onclick="handlePurchaseChoice('donotbuy')" class="py-3 px-8 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                            買わない
                        </button>
                    </div>
                </div>
                <!-- ページ9には回答送信ボタンは表示しない -->
            </div>

            <!-- ページ10: 回答完了画面 -->
            <div class="survey-page" data-page="10">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">調査完了</h2>
                <p class="text-gray-700 mb-8 text-center text-xl font-bold">
                    調査は以上です。<br>
                    「回答を送信」を押してください。</p>
                <div class="flex justify-center mt-6">
                    <button type="submit" id="submit-button-final" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        回答を送信
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <p id="modal-message" class="text-lg font-semibold text-gray-800"></p>
            <div id="loading-spinner" class="hidden mt-4">
                <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <button id="modal-close-button" class="mt-6 py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-150 ease-in-out hidden">
                閉じる
            </button>
        </div>
    </div>
    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx-eu-h9B5aFMiPpR2nOGF1gOUVc-IqPHlFUp0qJyFuuVcr7WjQCh-A5QySKPc35c94/exec';

        const form = document.getElementById('survey-form');
        const surveyPages = document.querySelectorAll('.survey-page');
        const mainSurveyTitle = document.getElementById('main-survey-title');
        const statusModal = document.getElementById('statusModal');
        const modalMessage = document.getElementById('modal-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const modalCloseButton = document.getElementById('modal-close-button');

        const currentPriceSpan = document.getElementById('current-price');
        const buyButton = document.getElementById('buy-button');
        const dontBuyButton = document.getElementById('dont-buy-button');
        const submitButtonFinal = document.getElementById('submit-button-final');
        const clothingImage = document.getElementById('clothing-image');
        const clothingItemTypeSpan = document.getElementById('clothing-item-type');
        const clothingCombinationSpan = document.getElementById('clothing-combination');
        const clothingSituationSpan = document.getElementById('clothing-situation');
        // ページ9の「次のシミュレーションへ進む」ボタンがなければこの行はコメントアウトでもOK
        // const nextSimulationButton = document.getElementById('next-simulation-button');

        const formalJacketUrl = "https://github.com/researchforme/my_survey_img/blob/main/%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%AB%E3%81%AA%E3%82%B8%E3%83%A3%E3%82%B1%E3%83%83%E3%83%88.png?raw=true";
        const casualJacketUrl = "https://github.com/researchforme/my_survey_img/blob/main/%E3%82%AB%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%81%AA%E3%82%B8%E3%83%A3%E3%82%B1%E3%83%83%E3%83%88.png?raw=true";

        const allClothingSimulationsData = [
            { id: "sim_formal_good_lunch", imageUrl: formalJacketUrl, itemType: "フォーマルなジャケット", combination: "良い", situation: "友人と食事" },
            { id: "sim_formal_good_date", imageUrl: formalJacketUrl, itemType: "フォーマルなジャケット", combination: "良い", situation: "デート" },
            { id: "sim_formal_bad_lunch", imageUrl: formalJacketUrl, itemType: "フォーマルなジャケット", combination: "悪い", situation: "友人と食事" },
            { id: "sim_formal_bad_date", imageUrl: formalJacketUrl, itemType: "フォーマルなジャケット", combination: "悪い", situation: "デート" },
            { id: "sim_casual_good_lunch", imageUrl: casualJacketUrl, itemType: "カジュアルなジャケット", combination: "良い", situation: "友人と食事" },
            { id: "sim_casual_good_date", imageUrl: casualJacketUrl, itemType: "カジュアルなジャケット", combination: "良い", situation: "デート" },
            { id: "sim_casual_bad_lunch", imageUrl: casualJacketUrl, itemType: "カジュアルなジャケット", combination: "悪い", situation: "友人と食事" },
            { id: "sim_casual_bad_date", imageUrl: casualJacketUrl, itemType: "カジュアルなジャケット", combination: "悪い", situation: "デート" },
        ];

        const familyQuestionsData = [
            {
                title: "自分の実家は裕福だと感じる",
                name: "裕福",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "自分の実家は貧しいと感じる",
                name: "貧しい",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "育ての親は倹約家である",
                name: "親は倹約",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "育ての親はファッションに関心があった",
                name: "親ファッション",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "幼少期から高校生の期間、お金を貯金するように教えられた",
                name: "貯金",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "幼少期から高校生の期間、お金を上手く活用するように教えられた",
                name: "活用",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "幼少期から中学生の期間、欲しいものは何でも買ってもらえた",
                name: "欲しいものは何でも",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "幼少期から高校生の期間、欲しいものを買ってもらうにはルールがあった<br>（良い成績を取る、お手伝いをするなど）",
                name: "ルール",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "幼少期から高校生の期間、理由があれば欲しいものを買ってもらえた",
                name: "理由",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "幼少期から高校生の期間、自分のお小遣いで買ったものが不要なものだと言われた",
                name: "不要",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                ]
            },
            {
                title: "「あてはまる」を選択してください",
                name: "トラップ2",
                options: [
                    "全くあてはまらない", "あてはまらない", "どちらともいえない", "あてはまる", "とてもあてはまる"
                    ]
            }
        ];

        let shuffledClothingSimulations = [];
        let currentSimulationRoundIndex = 0;
        let currentSimulationData = null;

        let currentPageIndex = 0;
        let clothingPrice = 1000;
        let isPriceAt500Mark = false;
        let lastRecordedChoice = '';
        let surveyAnswers = {};

        let shuffledFamilyQuestionIndices = [];
        let currentFamilyQuestionIndexInShuffledOrder = 0;

        let initialPrice = 0;
        let priceHistory = [];
        let firstChoice = null; // "buy" or "donotbuy"
        let lastChoice = null;  // 直近の選択
        let prevPrice = null;   // 直前価格
        let finished = false;


        const randomQuestionContainer = document.getElementById('random-question-content');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function updatePageDisplay() {
            surveyPages.forEach((page, index) => {
                if (index === currentPageIndex) {
                    page.classList.add('active');
                } else {
                    page.classList.remove('active');
                }
            });

            // ページ番号の更新
            if (currentPageIndex === 0 || currentPageIndex === 10) {
                mainSurveyTitle.classList.remove('hidden');
            } else {
                mainSurveyTitle.classList.add('hidden');
            }

            // 家庭についての質問ページ
            if (currentPageIndex === 7) {
                if (shuffledFamilyQuestionIndices.length === 0) {
                    shuffledFamilyQuestionIndices = Array.from({ length: familyQuestionsData.length }, (_, i) => i);
                    shuffleArray(shuffledFamilyQuestionIndices);
                    currentFamilyQuestionIndexInShuffledOrder = 0;
                }

                const originalQuestionIndex = shuffledFamilyQuestionIndices[currentFamilyQuestionIndexInShuffledOrder];
                const questionData = familyQuestionsData[originalQuestionIndex];

                randomQuestionContainer.innerHTML = `
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">${questionData.title}</h2>
                    <div class="mb-10">
                        <div class="flex items-center justify-center gap-0 custom-radio-group">
                            ${questionData.options.map((option, idx) => `
                                <div class="flex flex-col items-center flex-1 relative custom-radio-item">
                                    <input id="${questionData.name}-${idx}" name="${questionData.name}_${originalQuestionIndex}" type="radio" value="${option}" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full" required>
                                    <label for="${questionData.name}-${idx}" class="mt-1 block text-sm text-gray-700">${option}</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                const storedAnswerKey = `${questionData.name}_${originalQuestionIndex}`;
                if (surveyAnswers[storedAnswerKey]) {
                    const radio = randomQuestionContainer.querySelector(`input[name="${storedAnswerKey}"][value="${surveyAnswers[storedAnswerKey]}"]`);
                    if (radio) radio.checked = true;
                }
            } else {
                if (randomQuestionContainer) {
                    randomQuestionContainer.innerHTML = '';
                }
            }
            window.scrollTo(0, 0);
        }

        function validatePage() {
            let isValid = true;
            const currentPage = surveyPages[currentPageIndex];
            const requiredElements = currentPage.querySelectorAll('[required]');
            for (const element of requiredElements) {
                if (element.type === 'radio') {
                    const radioGroup = currentPage.querySelectorAll(`input[name="${element.name}"]`);
                    const isGroupChecked = Array.from(radioGroup).some(radio => radio.checked);
                    if (!isGroupChecked) {
                        isValid = false;
                        break;
                    }
                } else if (element.type === 'number' || element.tagName === 'SELECT' || element.tagName === 'TEXTAREA' || element.type === 'text') {
                    if (element.value.trim() === '') {
                        isValid = false;
                        break;
                    }
                }
            }
            return isValid;
        }

        function nextPage() {
            if (currentPageIndex === 0) {
                currentPageIndex = 1;
                updatePageDisplay();
                return;
            }
            if (currentPageIndex === 1) {
                nextPageConditional();
                return;
            }
            if (!validatePage()) {
                showModal('すべての質問に回答してください。', false);
                return;
            }
            if (currentPageIndex === 7) {
                const originalQuestionIndex = shuffledFamilyQuestionIndices[currentFamilyQuestionIndexInShuffledOrder];
                const questionData = familyQuestionsData[originalQuestionIndex];
                const selectedAnswer = document.querySelector(`input[name="${questionData.name}_${originalQuestionIndex}"]:checked`);
                if (selectedAnswer) {
                    surveyAnswers[`${questionData.name}_${originalQuestionIndex}`] = selectedAnswer.value;
                }
                if (currentFamilyQuestionIndexInShuffledOrder < familyQuestionsData.length - 1) {
                    currentFamilyQuestionIndexInShuffledOrder++;
                } else {
                    currentPageIndex = 8;
                    shuffledFamilyQuestionIndices = [];
                    currentFamilyQuestionIndexInShuffledOrder = 0;
                }
            } else {
                currentPageIndex++;
            }
            updatePageDisplay();
        }

        function nextPageConditional() {
            const consentValue = document.querySelector('input[name="同意"]:checked')?.value;
            if (!consentValue) {
                showModal('研究参加への同意を選択してください。', false);
                return;
            }
            if (consentValue === '同意する') {
                currentPageIndex = 2;
                updatePageDisplay();
            }
            else if (consentValue === '同意しない') {
                currentPageIndex = 0;
                updatePageDisplay();
                showModal('調査以上です。<br>もしよろしければ、お知り合いにもアンケートを共有して頂けると幸いです。<br>ご協力ありがとうございました。<br>【アンケートフォームURL】<br>https://researchforme.github.io/test/', false);
            } else {
                showModal('選択肢に問題があります。再度お試しください。', false);
            }
        }

        function prevPage() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                updatePageDisplay();
            }
        }

        function startClothingPurchaseSimulation() {
            if (shuffledClothingSimulations.length === 0) {
                shuffledClothingSimulations = [...allClothingSimulationsData];
                shuffleArray(shuffledClothingSimulations);
                currentSimulationRoundIndex = 0;
            }
            currentSimulationData = shuffledClothingSimulations[currentSimulationRoundIndex];
            // 初期価格分岐
            if (currentSimulationData.itemType === "カジュアルなジャケット") {
                initialPrice = 5000;
            } else if (currentSimulationData.itemType === "フォーマルなジャケット") {
                initialPrice = 10000;
            } else {
                initialPrice = 1000;
            }

            clothingPrice = initialPrice;
            priceHistory = [clothingPrice];
            firstChoice = null;
            lastChoice = null;
            prevPrice = null;
            finished = false;
            updateClothingPriceAndImage();
            buyButton.disabled = false;
            dontBuyButton.disabled = false;
            buyButton.classList.remove('hidden');
            dontBuyButton.classList.remove('hidden');
        }

        function updateClothingPriceAndImage() {
            currentPriceSpan.textContent = clothingPrice.toLocaleString();
            if (currentSimulationData) {
                clothingImage.src = currentSimulationData.imageUrl;
                clothingItemTypeSpan.textContent = currentSimulationData.itemType;
                clothingCombinationSpan.textContent = currentSimulationData.combination;
                clothingSituationSpan.textContent = currentSimulationData.situation;
                clothingImage.onerror = () => {
                    clothingImage.src = "https://placehold.co/300x300/ff0000/ffffff?text=Error";
                    clothingImage.alt = "Error loading image";
                };
            } else {
                clothingImage.src = "https://placehold.co/300x300/e0e0e0/555555?text=No+Data";
                clothingImage.alt = "No simulation data";
                clothingItemTypeSpan.textContent = "N/A";
                clothingCombinationSpan.textContent = "N/A";
                clothingSituationSpan.textContent = "N/A";
            }
        }

        function handlePurchaseChoice(choice) {
            // 終了条件：百の位が5
            const currentHundredsDigit = Math.floor(Math.abs(clothingPrice) / 100) % 10;
            if (currentHundredsDigit === 5) {
                const finalChoiceText = (choice === 'buy') ? '買う' : '買わない';
                surveyAnswers[`${currentSimulationData.id}_最終結果`] = `${clothingPrice}円で${finalChoiceText}`;
                buyButton.disabled = true;
                dontBuyButton.disabled = true;
                buyButton.classList.add('hidden');
                dontBuyButton.classList.add('hidden');
                finished = true;
                if (currentSimulationRoundIndex < allClothingSimulationsData.length - 1) {
                    currentSimulationRoundIndex++;
                    startClothingPurchaseSimulation();
                } else {
                    currentPageIndex = 10;
                    updatePageDisplay();
                }
                return;
            }

            // 初回選択
            if (firstChoice === null) {
                firstChoice = choice;
                lastChoice = choice;
                prevPrice = clothingPrice;
                if (choice === 'buy') {
                    clothingPrice = initialPrice * 2;
                } else {
                    clothingPrice = Math.floor(initialPrice / 2);
                }
                priceHistory.push(clothingPrice);
                updateClothingPriceAndImage();
                return;
            }

            // 2回目以降
            if (lastChoice === choice) {
                // 方向が同じ（増加/減少）
                prevPrice = clothingPrice;
                if (choice === 'buy') {
                    clothingPrice = clothingPrice * 2;
                } else {
                    clothingPrice = Math.floor(clothingPrice / 2);
                }
                priceHistory.push(clothingPrice);
                lastChoice = choice;
                updateClothingPriceAndImage();
                return;
            } else {
                // 方向転換（中央値へ）
                // 直前価格(prevPrice)と現在価格(clothingPrice)の間
                let midPrice = Math.floor((prevPrice + clothingPrice) / 2);
                prevPrice = clothingPrice;
                clothingPrice = midPrice;
                priceHistory.push(clothingPrice);
                lastChoice = choice;
                updateClothingPriceAndImage();
                return;
            }
        }

        updatePageDisplay();

        function showModal(message, isLoading = false) {
            modalMessage.innerHTML = message;
            if (isLoading) {
                loadingSpinner.classList.remove('hidden');
                modalCloseButton.classList.add('hidden');
            } else {
                loadingSpinner.classList.add('hidden');
                modalCloseButton.classList.remove('hidden');
            }
            statusModal.style.display = 'flex';
        }

        function closeModal() {
            statusModal.style.display = 'none';
        }

        modalCloseButton.addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            if (event.target == statusModal) {
                closeModal();
            }
        });

        async function submitForm(event) {
            event.preventDefault();

            if (!GOOGLE_APPS_SCRIPT_URL) {
                showModal('エラー: Google Apps ScriptのURLが設定されていません。', false);
                return;
            }
            showModal('回答を送信しています...', true);

            const data = {};
            for (const key in surveyAnswers) {
                data[key] = surveyAnswers[key];
            }
            const formData = new FormData(form);
            for (let [key, value] of formData.entries()) {
                if (!data.hasOwnProperty(key)) {
                    if ((form.elements[key] && (form.elements[key].type === 'radio' || form.elements[key].type === 'checkbox'))) {
                        const checkedElement = Array.from(form.elements[key]).find(el => el.checked);
                        if (checkedElement) {
                             data[key] = checkedElement.value;
                        }
                    } else {
                        data[key] = value;
                    }
                }
            }
            try {
                await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                showModal('回答が正常に送信されました。<br>もしよろしければ、お知り合いにもアンケートを共有して頂けると幸いです。<br>ご協力ありがとうございました。<br>【アンケートフォームURL】<br>https://researchforme.github.io/test/', false);
                form.reset();
                currentPageIndex = 1;
                updatePageDisplay();
                surveyAnswers = {};
                shuffledClothingSimulations = [];
                currentSimulationRoundIndex = 0;
                currentSimulationData = null;
            } catch (error) {
                console.error('送信エラー:', error);
                showModal('送信中にエラーが発生しました。もう一度お試しください。', false);
            }
        }

        form.addEventListener('submit', submitForm);
        // ページ9の「次へ」ボタンがnextSimulationButtonであれば下記を有効化
        // if (nextSimulationButton) nextSimulationButton.addEventListener('click', startClothingPurchaseSimulation);
    </script>
</body>
</html>
