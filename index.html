<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衣服の購買における金銭感覚の調査</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f3f4f6; /* 薄いグレーの背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
            overflow-x: hidden; /* 横スクロールを防ぐ */
        }

        /* 縦向きの場合のスタイル */
        @media screen and (orientation: portrait) {
            #orientation-message {
                display: flex; /* 縦向きの時のみ表示 */
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.9); /* 暗いオーバーレイ */
                color: white;
                font-size: 1.5rem;
                font-weight: bold;
                justify-content: center;
                align-items: center;
                text-align: center;
                z-index: 1000; /* 最前面に表示 */
                padding: 1rem;
            }
            #survey-container {
                display: none; /* 縦向きの時はアンケートを非表示 */
            }
        }

        /* 横向きの場合のスタイル */
        @media screen and (orientation: landscape) {
            #orientation-message {
                display: none; /* 横向きの時は非表示 */
            }
            #survey-container {
                display: block; /* 横向きの時はアンケートを表示 */
                max-width: 800px;
                width: 100%;
            }
        }

        /* カスタムモーダル */
        .modal {
            display: none; /* デフォルトで非表示 */
            position: fixed;
            z-index: 1001; /* オーバーレイより上 */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); /* 半透明の黒背景 */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            text-align: center;
            max-width: 90%;
            width: 400px;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* ページ切り替えアニメーション */
        .survey-page {
            display: none; /* デフォルトでは全てのページを非表示 */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .survey-page.active {
            display: block; /* アクティブなページのみ表示 */
            opacity: 1;
        }
    </style>
</head>
<body>

    <!-- 縦画面時のメッセージ -->
    <div id="orientation-message" class="hidden">
        <p>回答は<span class="text-yellow-400">横画面</span>で行ってください。<br>デバイスを回転させてください。</p>
    </div>

    <!-- アンケートコンテナ -->
    <div id="survey-container" class="bg-white p-8 rounded-lg shadow-xl border border-gray-200">
        <!-- メインタイトル（表紙ページでのみ表示） -->
        <h1 id="main-survey-title" class="text-4xl font-extrabold text-gray-900 mb-8 text-center">衣服の購買における金銭感覚の調査</h1>
        
        <form id="survey-form" class="space-y-6">

            <!-- ページ0: 表紙ページ -->
            <div class="survey-page active" data-page="0">
                <p class="text-gray-700 text-lg mb-10 text-center">
                    本調査にご協力いただきありがとうございます。<br>
                    アンケート対象者は、大学生・大学院生・専門学生、18～22歳です。<br>
                    衣服の購買に関するあなたの金銭感覚についてお伺いします。<br>
                    ご回答いただいた内容は統計的に処理され、<br>
                    個人が特定できる形で公開されることは一切ございません。<br>
                    また、本調査の目的以外で利用することもございませんので、ご安心ください。<br>
                </p>
                <div class="flex justify-center mt-12">
                    <button type="button" onclick="nextPage()" class="py-3 px-10 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ1: 宣言と同意 -->
            <div class="survey-page" data-page="1">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">宣言と同意</h2>
                <p class="text-gray-600 mb-8">
                    <br>
                    私は前ページの内容を確認しました。<br>
                    また、私は以下の質問をきちんと読んで、まじめに回答します。
                </p>
                <div class="mb-6">
                    <div class="flex items-center">
                        <input id="declaration-and-agreemant" name="宣言と同意" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                        <label for="declaration-and-agreemant" class="ml-3 block text-sm text-gray-700">はい</label>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        アンケートを開始
                    </button>
                </div>
            </div>

            <!-- ページ2: 基本情報 -->
            <div class="survey-page" data-page="2">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">基本情報</h2>
                <!-- 質問1: ドロップダウン -->
                <div class="mb-6">
                    <label for="age" class="block text-sm font-medium text-gray-700 mb-1">年齢</label>
                    <select id="age" name="年齢" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23以上">23以上</option>
                    </select>
                </div>
                <!-- 質問2: ラジオボタン -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">性別</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="gender-male" name="性別" type="radio" value="男性" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="gender-male" class="ml-3 block text-sm text-gray-700">男性</label>
                        </div>
                        <div class="flex items-center">
                            <input id="gender-female" name="性別" type="radio" value="女性" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="gender-female" class="ml-3 block text-sm text-gray-700">女性</label>
                        </div>
                        <div class="flex items-center">
                            <input id="gender-other" name="性別" type="radio" value="その他" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="gender-other" class="ml-3 block text-sm text-gray-700">その他</label>
                        </div>
                    </div>
                </div>
                <!-- 質問3: ラジオボタン -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">所属</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="affiliation-univ" name="所属" type="radio" value="大学生（専門学生を含む）" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="affiliation-univ" class="ml-3 block text-sm text-gray-700">大学生（専門学生を含む）</label>
                        </div>
                        <div class="flex items-center">
                            <input id="affiliation-grad" name="所属" type="radio" value="大学院生" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="affiliation-grad" class="ml-3 block text-sm text-gray-700">大学院生</label>
                        </div>
                        <div class="flex items-center">
                            <input id="affiliation-other" name="所属" type="radio" value="大学生ではない" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="affiliation-other" class="ml-3 block text-sm text-gray-700">大学生ではない</label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ3: 衣服の購買頻度などの質問 -->
            <div class="survey-page" data-page="3">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">衣服の購買頻度などの質問</h2>
                <!-- 質問: 購買頻度 -->
                <div class="mb-6">
                    <label for="purchase-frequency" class="block text-sm font-medium text-gray-700 mb-1">購買頻度</label>
                    <select id="purchase-frequency" name="購買頻度" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="1ヶ月に1回より多い">1ヶ月に1回より多い</option>
                        <option value="1ヶ月に1回程度">1ヶ月に1回程度</option>
                        <option value="2ヶ月に1回程度">2ヶ月に1回程度</option>
                        <option value="3ヶ月に1回程度">3ヶ月に1回程度</option>
                        <option value="4か月に1回程度かそれ以下">4か月に1回程度かそれ以下</option>
                    </select>
                </div>
                <!-- 質問: 一度に使う金額 -->
                <div class="mb-6">
                    <label for="single-purchase-amount" class="block text-sm font-medium text-gray-700 mb-1">一度に使う金額</label>
                    <select id="single-purchase-amount" name="一度に使う金額" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="3000円以内">3000円以内</option>
                        <option value="3001～4000円">3001～4000円</option>
                        <option value="4001～5000円">4001～5000円</option>
                        <option value="5001～6000円">5001～6000円</option>
                        <option value="6001～7000円">6001～7000円</option>
                        <option value="7001～8000円">7001～8000円</option>
                        <option value="8001～9000円">8001～9000円</option>
                        <option value="9001～10000円">9001～10000円</option>
                        <option value="1万円以上">1万円以上</option>
                    </select>
                </div>
                <!-- 質問: 1ヶ月の使用金額（平均） -->
                <div class="mb-6">
                    <label for="monthly-spending" class="block text-sm font-medium text-gray-700 mb-1">1ヶ月の使用金額（平均）</label>
                    <select id="monthly-spending" name="1ヶ月の使用金額（平均）" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="3000円以内">3000円以内</option>
                        <option value="3001～4000円">3001～4000円</option>
                        <option value="4001～5000円">4001～5000円</option>
                        <option value="5001～6000円">5001～6000円</option>
                        <option value="6001～7000円">6001～7000円</option>
                        <option value="7001～8000円">7001～8000円</option>
                        <option value="8001～9000円">8001～9000円</option>
                        <option value="9001～10000円">9001～10000円</option>
                        <option value="1万円以上">1万円以上</option>
                    </select>
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPageConditional()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ4: 所属世帯について -->
            <div class="survey-page" data-page="4">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">所属世帯について</h2>
                <!-- 質問: 所属世帯について (条件分岐のトリガー) -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">所属世帯について</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="household-live-with-parents" name="所属世帯" type="radio" value="実家暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-live-with-parents" class="mt-1 block text-sm text-gray-700">実家暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-hs" name="所属世帯" type="radio" value="高校生から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-live-alone-hs" class="mt-1 block text-sm text-gray-700">高校生から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-univ" name="所属世帯" type="radio" value="大学生から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-live-alone-univ" class="mt-1 block text-sm text-gray-700">大学生から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-grad" name="所属世帯" type="radio" value="大学院生から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-live-alone-grad" class="mt-1 block text-sm text-gray-700">大学院生から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-live-alone-work" name="所属世帯" type="radio" value="就職から一人暮らし" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-live-alone-work" class="mt-1 block text-sm text-gray-700">就職から一人暮らし</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-returned-home" name="所属世帯" type="radio" value="一人暮らしから実家暮らしに戻っている" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-returned-home" class="mt-1 block text-sm text-gray-700">一人暮らしから実家暮らしに戻っている</label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPageConditional()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ5: 実家暮らし選択時のページ -->
            <div class="survey-page" data-page="5">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">実家暮らしの方への質問</h2>
                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">家庭にお金を入れている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="household-contribute-yes" name="家庭にお金を入れている" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-contribute-yes" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="household-contribute-no" name="家庭にお金を入れている" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="household-contribute-no" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                    </div>
                </div>
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">奨学金を受け取っている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="scholarship-received-yes-home" name="奨学金" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="scholarship-received-yes-home" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="scholarship-received-no-home" name="奨学金" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="scholarship-received-no-home" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                    </div>
                </div>
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label for="part-time-income-home" class="block text-sm font-medium text-gray-700 mb-1">アルバイトの収入</label>
                    <select id="part-time-income-home" name="アルバイトの収入" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="月5万円未満">月5万円未満</option>
                        <option value="月5～6万円">月5～6万円</option>
                        <option value="月6～7万円">月6～7万円</option>
                        <option value="月7～8万円">月7～8万円</option>
                        <option value="月8万円以上">月8万円以上</option>
                        <option value="アルバイトをしていない">アルバイトをしていない</option>
                        <option value="就職している">就職している</option>
                    </select>
                </div>
                
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPageConditional()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ6: 一人暮らし選択時のページ -->
            <div class="survey-page" data-page="6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">一人暮らしの方への質問</h2>
                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">家賃補助を実家から受け取っている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="rent-subsidy-yes-alone" name="家賃補助" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="rent-subsidy-yes-alone" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="rent-subsidy-no-alone" name="家賃補助" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="rent-subsidy-no-alone" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                    </div>
                </div>
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">奨学金を受け取っている</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="scholarship-received-yes-alone" name="奨学金" type="radio" value="はい" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="scholarship-received-yes-alone" class="mt-1 block text-sm text-gray-700">はい</label>
                        </div>
                        <div class="flex items-center">
                            <input id="scholarship-received-no-alone" name="奨学金" type="radio" value="いいえ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                            <label for="scholarship-received-no-alone" class="mt-1 block text-sm text-gray-700">いいえ</label>
                        </div>
                    </div>
                </div>
                <!-- 質問間の区切り線 -->
                <div class="border-b border-gray-300 my-6 w-full"></div>

                <div class="mb-8">
                    <label for="part-time-income-alone" class="block text-sm font-medium text-gray-700 mb-1">アルバイトの収入</label>
                    <select id="part-time-income-alone" name="アルバイトの収入" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="月5万円未満">月5万円未満</option>
                        <option value="月5～6万円">月5～6万円</option>
                        <option value="月6～7万円">月6～7万円</option>
                        <option value="月7～8万円">月7～8万円</option>
                        <option value="月8万円以上">月8万円以上</option>
                        <option value="アルバイトをしていない">アルバイトをしていない</option>
                        <option value="就職している">就職している</option>
                    </select>
                </div>
                
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPageConditional()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ7: 家庭についての質問 (ランダム表示用コンテナ) -->
            <div class="survey-page" data-page="7">
                <div id="random-question-content" class="text-center">
                    <!-- ランダムな質問がここに挿入されます -->
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPage()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ8: 衣服の購買シミュレーション説明 -->
            <div class="survey-page" data-page="8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">衣服の購買シミュレーション説明</h2>
                <p class="text-gray-600 mb-8">
                    これから衣服の画像と価格、その他の情報が表示されます。<br>
                    あなたは、その衣服を「買う」か「買わない」かを選択してください。<br>
                    ※選択後すぐに、新しい情報へ更新されるため、ボタンを連打しないよう注意してください。
                </p>
                <div class="mb-6">
                    <div class="flex items-center">
                        <input id="confirmation" name="確認" type="radio" value="確認しました" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                        <label for="confirmation" class="ml-3 block text-sm text-gray-700">確認しました</label>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="prevPage()" class="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        戻る
                    </button>
                    <button type="button" onclick="nextPageConditional()" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        次へ
                    </button>
                </div>
            </div>

            <!-- ページ9: 衣服の購買シミュレーション -->
            <div class="survey-page" data-page="9">
                <!-- h2タグは削除済み -->
                <div class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg shadow-inner mb-6">
                    <img id="clothing-image" src="https://placehold.co/300x300/e0e0e0/555555?text=Clothing+Item" alt="Clothing Item" class="rounded-md shadow-md mb-4">
                    <p class="text-2xl font-bold text-gray-900 mb-6">価格: <span id="current-price"></span>円</p>
                    <div class="flex space-x-4">
                        <button type="button" id="buy-button" onclick="handlePurchaseChoice('buy')" class="py-3 px-8 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                            買う
                        </button>
                        <button type="button" id="dont-buy-button" onclick="handlePurchaseChoice('donotbuy')" class="py-3 px-8 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                            買わない
                        </button>
                    </div>
                </div>
                <!-- ページ9には回答送信ボタンは表示しない -->
            </div>

            <!-- ページ10: 回答完了画面 -->
            <div class="survey-page" data-page="10">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">調査完了</h2>
                <p class="text-gray-600 mb-8 text-center text-xl font-bold">調査は以上です。ご協力ありがとうございました。</p>
                <div class="flex justify-center mt-6">
                    <button type="submit" id="submit-button-final" class="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        回答を送信
                    </button>
                </div>
            </div>

        </form>
    </div>

    <!-- ローディングとメッセージ表示用のモーダル -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <p id="modal-message" class="text-lg font-semibold text-gray-800"></p>
            <div id="loading-spinner" class="hidden mt-4">
                <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <button id="modal-close-button" class="mt-6 py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-150 ease-in-out hidden">
                閉じる
            </button>
        </div>
    </div>

    <script>
        // Google Apps ScriptのWebアプリのURLをここに設定します
        // デプロイ後にGoogle Apps Scriptから取得したURLに置き換えてください
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbylXU-o-d9G8OdKuGXKcF6Tp-g2zaqdcwVyRDdd2-DYCdRPgod3nXRgeidZ_C8V5UWM/exec'; 

        const form = document.getElementById('survey-form');
        const surveyPages = document.querySelectorAll('.survey-page');
        const mainSurveyTitle = document.getElementById('main-survey-title'); // メインタイトル要素
        const statusModal = document.getElementById('statusModal');
        const modalMessage = document.getElementById('modal-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const modalCloseButton = document.getElementById('modal-close-button');

        // シミュレーション関連の要素
        const currentPriceSpan = document.getElementById('current-price');
        const buyButton = document.getElementById('buy-button');
        const dontBuyButton = document.getElementById('dont-buy-button');
        const submitButtonFinal = document.getElementById('submit-button-final'); // ページ10の最終送信ボタン
        
        // ランダム化する家庭についての質問データ
        const familyQuestionsData = [
            {
                title: "自分の実家は裕福だと感じる",
                name: "裕福",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "自分の実家は貧しいと感じる",
                name: "貧しい",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "母親は倹約家である",
                name: "母親は倹約",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "父親は倹約家である",
                name: "父親は倹約",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "母親はファッションに関心があった",
                name: "母親ファッション",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "父親はファッションに関心があった",
                name: "父親ファッション",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "子供のころお金を貯金するように教えられた",
                name: "貯金",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "子供のころお金を上手く活用するように教えられた",
                name: "活用",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "子供のころ欲しいものは何でも買ってもらえた",
                name: "欲しいものは何でも",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "子供のころ欲しいものを買ってもらうにはルールがあった（良い成績を取る、お手伝いをするなど）",
                name: "ルール",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "子供のころ理由があれば欲しいものを買ってもらえた",
                name: "理由",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            },
            {
                title: "子供のころ自分のお小遣いで買ったものが不要なものだと言われた",
                name: "不要",
                options: [
                    "とてもあてはまる", "あてはまる", "どちらともいえない", "あてはまらない", "まったくあてはまらない"
                ]
            }
        ];

        let currentPageIndex = 0; // 現在表示されているページのインデックス (0始まり)
        let clothingPrice = 1000; // 衣服の初期価格
        let isPriceAt500Mark = false; // 百の位が5の価格に達しているかどうかのフラグ
        let lastRecordedChoice = ''; // シミュレーションの最後に記録された選択 (買う/買わない)
        let surveyAnswers = {}; // 全てのアンケート回答を保存するオブジェクト

        let shuffledFamilyQuestionIndices = []; // ランダム化された質問の順序を格納
        let currentFamilyQuestionIndexInShuffledOrder = 0; // ランダム化された質問ブロック内の現在の質問インデックス

        const randomQuestionContainer = document.getElementById('random-question-content');

        // Fisher-Yates シャッフルアルゴリズム
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ページを更新して表示する関数
        function updatePageDisplay() {
            surveyPages.forEach((page, index) => {
                if (index === currentPageIndex) {
                    page.classList.add('active'); // アクティブなページを表示
                } else {
                    page.classList.remove('active'); // それ以外のページを非表示
                }
            });

            // メインタイトルは表紙ページ (index 0) でのみ表示
            if (currentPageIndex === 0) {
                mainSurveyTitle.classList.remove('hidden');
            } else {
                mainSurveyTitle.classList.add('hidden');
            }

            // 家庭についての質問ページ (data-page="7") の特殊処理
            if (currentPageIndex === 7) {
                // 初めてこのセクションに入る場合、または前回のセッションから再開する場合
                if (shuffledFamilyQuestionIndices.length === 0 || currentFamilyQuestionIndexInShuffledOrder >= familyQuestionsData.length) {
                    shuffledFamilyQuestionIndices = Array.from({ length: familyQuestionsData.length }, (_, i) => i);
                    shuffleArray(shuffledFamilyQuestionIndices);
                    currentFamilyQuestionIndexInShuffledOrder = 0;
                }

                const originalQuestionIndex = shuffledFamilyQuestionIndices[currentFamilyQuestionIndexInShuffledOrder];
                const questionData = familyQuestionsData[originalQuestionIndex];
                
                // 質問のHTMLを動的に生成して挿入
                randomQuestionContainer.innerHTML = `
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">${questionData.title}</h2>
                    <div class="mb-10">
                        <div class="mt-2 flex flex-wrap gap-x-6 gap-y-4 justify-center">
                            ${questionData.options.map((option, idx) => `
                                <div class="flex flex-col items-center">
                                    <input id="${questionData.name}-${idx}" name="${questionData.name}_${originalQuestionIndex}" type="radio" value="${option}" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded-full">
                                    <label for="${questionData.name}-${idx}" class="mt-1 block text-sm text-gray-700">${option}</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                // 以前に選択された回答があれば復元
                const storedAnswerKey = `${questionData.name}_${originalQuestionIndex}`;
                if (surveyAnswers[storedAnswerKey]) {
                    const radio = randomQuestionContainer.querySelector(`input[name="${storedAnswerKey}"][value="${surveyAnswers[storedAnswerKey]}"]`);
                    if (radio) {
                        radio.checked = true;
                    }
                }
            } else {
                // 家庭についての質問ページ以外では内容をクリア
                if (randomQuestionContainer) {
                    randomQuestionContainer.innerHTML = '';
                }
            }

            window.scrollTo(0, 0); // ページ上部にスクロール

            // ページ9に移動した際にシミュレーションを開始 (インデックスは9)
            if (currentPageIndex === 9) { 
                startClothingPurchaseSimulation();
            }
        }

        // 次のページへ進む関数 (一般的な遷移)
        function nextPage() {
            // ページ1: 宣言と同意 のラジオボタンの選択をチェック
            if (currentPageIndex === 1) {
                const agreementRadio = document.querySelector('input[name="宣言と同意"]:checked');
                // ラジオボタンが選択されていない場合
                if (!agreementRadio) {
                      showModal('「はい」を選択してください。', false); // モーダルでエラーメッセージを表示
                    return; // ページ遷移を中止
                }
            }

            // ページ7: 家庭についての質問 (ランダム化された質問) の選択をチェック
            if (currentPageIndex === 7) {
                const originalQuestionIndex = shuffledFamilyQuestionIndices[currentFamilyQuestionIndexInShuffledOrder];
                const questionData = familyQuestionsData[originalQuestionIndex];
                // 現在表示されている質問のラジオボタンが選択されているかを確認
                const selectedAnswer = document.querySelector(`input[name="${questionData.name}_${originalQuestionIndex}"]:checked`);
        
                // 回答が選択されていない場合はエラーメッセージを表示し、遷移を阻止
                if (!selectedAnswer) {
                    showModal('選択肢を選んでください。', false); // モーダルでエラーメッセージを表示
                    return; // ページ遷移を中止
                }
                // 回答を保存
                surveyAnswers[`${questionData.name}_${originalQuestionIndex}`] = selectedAnswer.value;

                // 次のランダム質問へ、または次のセクションへ遷移
                if (currentFamilyQuestionIndexInShuffledOrder < familyQuestionsData.length - 1) {
                    currentFamilyQuestionIndexInShuffledOrder++;
                } else {
                    // 全てのランダム質問が完了したら、次のメインセクションへ
                    currentPageIndex = 8; // シミュレーション説明ページへ
                    // ランダム質問関連のインデックスをリセット
                    shuffledFamilyQuestionIndices = [];
                    currentFamilyQuestionIndexInShuffledOrder = 0;
                }
            } 
            // その他のページは単純に次へ
            else if (currentPageIndex < surveyPages.length - 1) {
                currentPageIndex++;
             }
            updatePageDisplay();
        }
        // 条件分岐を含む次のページへ進む関数
        function nextPageConditional() {
            // 所属世帯について (currentPageIndex === 4)
            if (currentPageIndex === 4) {
                const selectedHouseholdType = document.querySelector('input[name="所属世帯"]:checked');
                
                if (!selectedHouseholdType) {
                    showModal('所属世帯を選択してください。', false);
                    return;
                }

                const isAloneLiving = [
                    '高校生から一人暮らし',
                    '大学生から一人暮らし',
                    '大学院生から一人暮らし',
                    '就職から一人暮らし'
                ].includes(selectedHouseholdType.value);

                if (isAloneLiving) {
                    currentPageIndex = 6; // 一人暮らしの方への質問 (ページ6)
                } else {
                    currentPageIndex = 5; // 実家暮らしの方への質問 (ページ5)
                }
            } 

            // ページ8: 衣服の購買シミュレーション説明 のラジオボタンの選択をチェック
            // ページ8の「次へ」ボタンはnextPageConditional()を呼び出す
            else if (currentPageIndex === 8) {
                const confirmationRadio = document.querySelector('input[name="確認"]:checked');
                // ラジオボタンが選択されていない場合
                if (!confirmationRadio) {
                    showModal('「確認しました」を選択してください。', false); // モーダルでエラーメッセージを表示
                    return; // ページ遷移を中止
                }
                // 確認済みであれば、シミュレーション本体ページへ遷移
                currentPageIndex = 9; 
            }
                
            // 実家暮らしまたは一人暮らしの質問の後の遷移 (ページ5またはページ6から家庭についての質問の最初のページ7へ)
            else if (currentPageIndex === 5 || currentPageIndex === 6) {
                currentPageIndex = 7; // 家庭についての質問の最初のページ7へ
            }
            // シミュレーション説明 (ページ8) からシミュレーション本体 (ページ9) へ
            else if (currentPageIndex === 8) {
                currentPageIndex = 9; // ページ9へ移動
            }
            // シミュレーション終了時 (handlePurchaseChoiceから呼ばれる) は直接ページ10へ遷移
            // ここでは他のページで誤って呼ばれないように空のelseとしておく
            else {
                currentPageIndex++; // 念のため、予期しないケースでは次のページへ進む
            }
            updatePageDisplay();
        }

        // 前のページへ戻る関数
        function prevPage() {
            if (currentPageIndex > 0) {
                // 回答完了画面 (ページ10) からシミュレーション本体 (ページ9) へ
                if (currentPageIndex === 10) {
                    currentPageIndex = 9;
                }
                // シミュレーション本体 (ページ9) からシミュレーション説明 (ページ8) へ
                else if (currentPageIndex === 9) {
                    currentPageIndex = 8;
                }
                // シミュレーション説明 (ページ8) から家庭についての質問の最後のページ (ページ7) へ
                else if (currentPageIndex === 8) {
                    currentPageIndex = 7;
                    currentFamilyQuestionIndexInShuffledOrder = familyQuestionsData.length - 1; // ランダム質問の最後の質問に戻る
                }
                // 家庭についての質問のランダム化されたページ内での戻る
                else if (currentPageIndex === 7) {
                    if (currentFamilyQuestionIndexInShuffledOrder > 0) {
                        currentFamilyQuestionIndexInShuffledOrder--;
                    } else {
                        // ランダム質問の最初の質問から戻る場合、所属世帯タイプに応じてページ5または6へ
                        const selectedHouseholdType = document.querySelector('input[name="所属世帯"]:checked');
                        const isAloneLiving = [
                            '高校生から一人暮らし',
                            '大学生から一人暮らし',
                            '大学院生から一人暮らし',
                            '就職から一人暮らし'
                        ].includes(selectedHouseholdType ? selectedHouseholdType.value : '');

                        if (isAloneLiving) {
                            currentPageIndex = 6; // 一人暮らしの方への質問 (ページ6)
                        } else {
                            currentPageIndex = 5; // 実家暮らしの方への質問 (ページ5)
                        }
                        // ランダム質問関連のインデックスをリセット
                        shuffledFamilyQuestionIndices = [];
                        currentFamilyQuestionIndexInShuffledOrder = 0;
                    }
                }
                // 実家暮らしまたは一人暮らしの質問ページ (ページ5またはページ6) から所属世帯 (ページ4) へ
                else if (currentPageIndex === 5 || currentPageIndex === 6) {
                    currentPageIndex = 4;
                }
                // その他のページは単純に前へ
                else {
                    currentPageIndex--;
                }
                updatePageDisplay();
            }
        }

        // シミュレーションを開始する関数
        function startClothingPurchaseSimulation() {
            clothingPrice = 1000; // 価格をリセット
            isPriceAt500Mark = false; // シミュレーション状態をリセット
            updateClothingPriceDisplay();
            buyButton.disabled = false;
            dontBuyButton.disabled = false;
        }

        // 価格表示を更新する関数
        function updateClothingPriceDisplay() {
            currentPriceSpan.textContent = clothingPrice.toLocaleString();
        }

        // 購買選択を処理する関数
        function handlePurchaseChoice(choice) {
            // シミュレーションが終了すべきかどうかを、現在の選択を適用する前にチェック
            if (isPriceAt500Mark) {
                // もし価格がX500円のマークに達していた場合（この選択の直前）、
                // 今回のクリックが「最後にもう一度選択」となる
                const finalRecordedPrice = clothingPrice; // この時点で記録すべき価格（X500円）
                const finalChoiceText = (choice === 'buy') ? '買う' : '買わない';

                // ボタンを無効化し、結果を記録してシミュレーションを終了
                buyButton.disabled = true;
                dontBuyButton.disabled = true;

                // 最終結果を surveyAnswers に追加
                surveyAnswers['最終購買選択結果'] = `${finalRecordedPrice}円で${finalChoiceText}`; 

                currentPageIndex = 10; // 回答完了画面へ遷移
                updatePageDisplay();
                isPriceAt500Mark = false; // フラグをリセット
                return; // シミュレーション終了後、関数を抜ける
            }

            // シミュレーションが終了しない場合、価格変動を適用
            let choiceText = '';
            if (choice === 'buy') {
                clothingPrice += 1000;
                choiceText = '買う';
            } else if (choice === 'donotbuy') {
                clothingPrice -= 500;
                choiceText = '買わない';
            }
            lastRecordedChoice = choiceText; // 現在の選択を記録

            updateClothingPriceDisplay(); // 表示価格を更新

            // 価格変動後、現在の価格の百の位が5かどうかをチェック
            // もし5であれば、次の選択が最終選択となるようフラグを設定
            const currentHundredsDigit = Math.floor(Math.abs(clothingPrice) / 100) % 10;
            if (currentHundredsDigit === 5) {
                isPriceAt500Mark = true; 
            } else {
                isPriceAt500Mark = false; // 5でなければフラグをリセット
            }
        }

        // 初期表示
        updatePageDisplay();

        // モーダルを表示する関数
        function showModal(message, isLoading = false) {
            modalMessage.textContent = message;
            if (isLoading) {
                loadingSpinner.classList.remove('hidden');
                modalCloseButton.classList.add('hidden'); 
            } else {
                loadingSpinner.classList.add('hidden');
                modalCloseButton.classList.remove('hidden');
            }
            statusModal.style.display = 'flex'; 
        }

        // モーダルを閉じる関数
        function closeModal() {
            statusModal.style.display = 'none';
        }

        // 閉じるボタンにイベントリスナーを追加
        modalCloseButton.addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            if (event.target == statusModal) {
                closeModal();
            }
        });

        // フォーム送信処理を関数化
        async function submitForm(event) {
            event.preventDefault(); // デフォルトのフォーム送信をキャンセル
            
            // Google Apps ScriptのURLが設定されているか確認
            if (!GOOGLE_APPS_SCRIPT_URL) { 
                showModal('エラー: Google Apps ScriptのURLが設定されていません。', false);
                return;
            }

            showModal('回答を送信しています...', true); // 送信中にローディングを表示

            // surveyAnswers オブジェクトから FormData を構築
            const formDataToSend = new FormData();
            for (const key in surveyAnswers) {
                formDataToSend.append(key, surveyAnswers[key]);
            }
            // フォームの残りの要素も追加（隠しフィールドなど）
            const formElements = form.elements;
            for (let i = 0; i < formElements.length; i++) {
                const element = formElements[i];
                if (element.name && !surveyAnswers.hasOwnProperty(element.name) && element.type !== 'submit' && element.type !== 'button') {
                     // ラジオボタンやチェックボックスはname属性が重複するため、valueが空でないもののみ追加
                    if ((element.type === 'radio' || element.type === 'checkbox') && !element.checked) {
                        continue;
                    }
                    if (element.value) { // 空の値は送信しない
                         formDataToSend.append(element.name, element.value);
                    }
                }
            }


            try {
                // FormDataをURLSearchParamsに変換（GASのPOST形式に合わせるため）
                const urlEncodedData = new URLSearchParams(formDataToSend).toString();

                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // CORSエラーを避けるためにno-corsを使用
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded', // URLエンコード形式を指定
                    },
                    body: urlEncodedData,
                });

                showModal('回答が正常に送信されました！ご協力ありがとうございます。', false);
                form.reset(); // フォームをリセット
                currentPageIndex = 0; // 最初のページに戻す
                updatePageDisplay(); // 最初のページを表示
                surveyAnswers = {}; // 回答データをリセット
            } catch (error) {
                console.error('送信エラー:', error);
                showModal('送信中にエラーが発生しました。もう一度お試しください。', false);
            }
        }

        // フォーム全体のsubmitイベントリスナーを登録
        form.addEventListener('submit', submitForm);
    </script>
</body>
</html>
